# ZQverse 主题页脚自定义功能说明

## 功能概述

本次更新为 ZQverse 主题添加了页脚内容自定义功能，允许用户通过后台设置面板直接修改、添加或删除页脚文字和代码内容，无需修改主题文件。

## 修改内容

### 1. 后台设置字段添加

在 `functions.php` 文件的 `themeConfig()` 函数中添加了新的设置字段：

```php
// 自定义页脚内容
$footer_custom = new \Typecho\Widget\Helper\Form\Element\Textarea(
    'footer_custom',
    null,
    '默认页脚内容...',
    _t('页脚自定义内容'),
    _t('支持 HTML 和 PHP 代码，可用于设置备案号、版权、友情链接等内容。留空则使用默认页脚内容。')
);
$form->addInput($footer_custom);
```

**字段说明：**
- **字段名：** `footer_custom`
- **类型：** 多行文本输入框
- **默认值：** 包含所有可用的动态内容选项作为模板，可直接修改
- **说明：** 支持 HTML 和 PHP 代码，显示所有可用的动态内容选项作为模板，可直接修改、删除或添加内容

### 2. 页脚文件修改

修改了以下两个页脚文件：
- `php_modules/footer.php`
- `php_modules/page_footer.php`

**修改逻辑：**
```php
<?php 
$footer_custom = $this->options->footer_custom;
if (!empty($footer_custom)) {
    // 安全输出自定义页脚内容
    echo htmlspecialchars_decode($footer_custom);
} else {
    // 默认页脚内容
    // ... 原有的页脚代码
}
?>
```

## 使用方法

### 1. 访问后台设置

1. 登录 Typecho 后台
2. 进入 "控制台" → "外观" → "设置外观"
3. 找到 "页脚自定义内容" 字段

### 2. 自定义页脚内容

在 "页脚自定义内容" 输入框中，您会看到所有可用的动态内容选项作为模板，包括：

#### 可用的动态内容选项
1. **关于页面链接** - 自动检测并显示关于页面
2. **友情链接页面** - 自动检测并显示友情链接页面
3. **站点地图** - 链接到 sitemap.xml
4. **版权信息** - 显示网站标题
5. **联系地址** - 可在下方"底部联系地址"字段设置
6. **联系邮箱** - 显示作者邮箱
7. **版权年份和网站标题** - 动态年份 + 网站标题
8. **备案信息** - 可在上方"备案信息"字段设置
9. **Typecho 链接** - 显示 "Blog By Typecho"
10. **自定义备案信息示例** - 可直接修改的备案信息模板
11. **自定义友情链接示例** - 可直接修改的友情链接模板
12. **自定义版权声明示例** - 可直接修改的版权声明模板

#### 使用方法
- **直接修改：** 所有选项都已释放，您可以直接修改内容
- **删除不需要：** 删除您不需要显示的项目
- **添加新内容：** 在任意位置添加您自己的内容
- **修改示例：** 直接修改示例中的链接、文字等内容

#### 示例：只显示版权和备案信息
```php
<!-- 版权年份和网站标题 -->
<div class="footer-item">
  <a href="<?php $this->options->siteUrl();?>" target="_self" title="<?php $this->options->title();?>">&copy;<?php echo date('Y'); ?> <?php $this->options->title();?></a>
</div>

<!-- 备案信息 -->
<?php $this->options->filing();?>

<!-- 自定义备案信息 -->
<div class="footer-item">
  <a href="https://beian.miit.gov.cn/" target="_blank" rel="noopener nofollow">京ICP备12345678号-1</a>
</div>
```

### 3. 恢复默认内容

如果输入框留空，系统将自动使用默认的页脚内容。

## 安全特性

1. **XSS 防护：** 使用 `htmlspecialchars_decode()` 函数安全输出内容
2. **空值判断：** 对自定义内容进行空值检查，避免报错
3. **向后兼容：** 保持原有功能不变，新增功能为可选

## 默认页脚内容

默认页脚包含以下内容：
- 关于页面链接（如果存在）
- 友情链接页面链接（如果存在）
- 站点地图链接
- 版权信息
- 联系地址
- 联系邮箱
- 版权年份和网站标题
- 备案信息（通过 `$this->options->filing()` 调用）
- Typecho 链接

## 注意事项

1. **PHP 代码支持：** 自定义内容支持完整的 PHP 代码，可以使用所有 Typecho 的变量和函数
2. **样式保持：** 建议使用 `footer-item` 类名保持与原有样式一致
3. **直接修改：** 所有选项都已释放，您可以直接修改、删除或添加内容
4. **测试建议：** 修改后建议在多个页面测试显示效果
5. **备份建议：** 在大量修改前建议备份当前设置
6. **字段关联：** 联系地址可在"底部联系地址"字段设置，备案信息可在"备案信息"字段设置

## 技术实现

- **字段类型：** `Typecho_Widget_Helper_Form_Element_Textarea`
- **存储方式：** 通过 Typecho 的 options 系统存储
- **输出方式：** 使用 `echo htmlspecialchars_decode()` 安全输出
- **兼容性：** 支持 Typecho 1.2+ 版本

## 更新日志

- **2024-01-XX：** 添加页脚自定义功能
  - 新增后台设置字段 `footer_custom`
  - 修改页脚文件支持自定义内容
  - 添加安全输出机制
  - 保持向后兼容性 